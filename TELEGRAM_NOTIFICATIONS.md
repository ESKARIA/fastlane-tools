# üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ lanes:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å–±–æ—Ä–∫–∏
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∏ –≤ TestFlight
- ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π **—Ç–æ–∫–µ–Ω –±–æ—Ç–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–∏—á–Ω—ã–π —á–∞—Ç
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∞—à–µ–º—É –±–æ—Ç—É
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":123456789}` ‚Äî —ç—Ç–æ –≤–∞—à Chat ID

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç
1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. –ù–∞–π–¥–∏—Ç–µ Chat ID –≥—Ä—É–ø–ø—ã (–æ–±—ã—á–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
export TELEGRAM_ENABLED="true"

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
export TELEGRAM_BOT_TOKEN="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"

# Chat ID (–ª–∏—á–Ω—ã–π –∏–ª–∏ –≥—Ä—É–ø–ø–æ–≤–æ–π)
export TELEGRAM_CHAT_ID="123456789"
```

### –®–∞–≥ 4: –í CI/CD (GitLab CI –ø—Ä–∏–º–µ—Ä)

```yaml
variables:
  TELEGRAM_ENABLED: "true"
  TELEGRAM_BOT_TOKEN: "${TELEGRAM_BOT_TOKEN}"  # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏–∑ CI/CD secrets
  TELEGRAM_CHAT_ID: "${TELEGRAM_CHAT_ID}"      # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏–∑ CI/CD secrets

build:
  script:
    - bundle exec fastlane build
```

## üì® –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. –£—Å–ø–µ—à–Ω–∞—è —Å–±–æ—Ä–∫–∞

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- ‚úÖ –°—Ç–∞—Ç—É—Å
- –í–µ—Ä—Å–∏—è
- Build number
- –†–∞–∑–º–µ—Ä IPA —Ñ–∞–π–ª–∞

**–ü—Ä–∏–º–µ—Ä:**
```
‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

–í–µ—Ä—Å–∏—è: 1.2.3
Build: 456
–†–∞–∑–º–µ—Ä IPA: 125.5MB
IPA: AppName_v1.2.3_b456.ipa
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ TestFlight (Internal)

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è internal testers

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- ‚úÖ –°—Ç–∞—Ç—É—Å
- –í–µ—Ä—Å–∏—è
- Build number

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ TestFlight (External)

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è external testers

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- ‚úÖ –°—Ç–∞—Ç—É—Å
- –í–µ—Ä—Å–∏—è
- Build number
- –ì—Ä—É–ø–ø—ã testers

### 4. –û—à–∏–±–∫–∏

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:** –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –≤ –ª—é–±–æ–º lane

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- ‚ùå –°—Ç–∞—Ç—É—Å
- –ù–∞–∑–≤–∞–Ω–∏–µ lane
- –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
- –í—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```bash
export TELEGRAM_ENABLED="false"
```

–∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TELEGRAM_ENABLED`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∫–æ–¥–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```ruby
# –û—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
notify_telegram_success("–ó–∞–≥–æ–ª–æ–≤–æ–∫", {
  '–ü–∞—Ä–∞–º–µ—Ç—Ä 1' => '–ó–Ω–∞—á–µ–Ω–∏–µ 1',
  '–ü–∞—Ä–∞–º–µ—Ç—Ä 2' => '–ó–Ω–∞—á–µ–Ω–∏–µ 2'
})

# –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
begin
  # –≤–∞—à –∫–æ–¥
rescue StandardError => e
  notify_telegram_error("–û—à–∏–±–∫–∞", e, {
    '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' => '–ó–Ω–∞—á–µ–Ω–∏–µ'
  })
  raise
end
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
export TELEGRAM_ENABLED="true"
export TELEGRAM_BOT_TOKEN="your_token"
export TELEGRAM_CHAT_ID="your_chat_id"

fastlane build
```

### –ü—Ä–∏–º–µ—Ä 2: –¢–æ–ª—å–∫–æ –¥–ª—è –æ—à–∏–±–æ–∫

–ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –≤ `error` handler –≤ `Fastfile`, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏:

```ruby
error do |lane, exception, _options|
  # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  if ENV['TELEGRAM_ENABLED'] == 'true'
    notify_telegram_error("–û—à–∏–±–∫–∞ –≤ lane '#{lane}'", exception)
  end
end
```

### –ü—Ä–∏–º–µ—Ä 3: –ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç

```bash
export TELEGRAM_CHAT_ID="-1001234567890"  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–ª—è –≥—Ä—É–ø–ø—ã
```

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω–æ:**
- ‚ùå **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ** —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CI/CD secrets –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Chat ID

## üêõ Troubleshooting

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```bash
   echo $TELEGRAM_ENABLED
   echo $TELEGRAM_BOT_TOKEN
   echo $TELEGRAM_CHAT_ID
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
   ```bash
   curl "https://api.telegram.org/bot<YOUR_TOKEN>/getMe"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Chat ID:**
   ```bash
   curl "https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates"
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ fastlane:**
   ```bash
   fastlane build --verbose
   ```

### –û—à–∏–±–∫–∞ "Forbidden"

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Chat ID

### –û—à–∏–±–∫–∞ "Bad Request"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Chat ID –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [@BotFather](https://t.me/botfather)


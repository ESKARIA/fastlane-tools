lane :match_install do |options|

    api_key = app_store_connect_api_key(key_id: APPSTORE_KEY_ID,
                            issuer_id: APPSTORE_ISSUER_ID,
                            key_content: APPSTORE_KEY_CONTENT,
                            in_house: false,
                            is_key_content_base64: true)

    match(type: 'development',
          app_identifier: ENV['APP_IDENTIFIER'],
          api_key: api_key,
          force_for_new_devices: options[:update],
          include_all_certificates: options[:update],
          force_for_new_certificates: options[:update],
          readonly: options[:update] ? false : true,
          force: true,
          platform: 'ios',
          verbose: true,
          generate_apple_certs: false,
          git_branch: "development"
          )

end

lane :match_sign do |options|

    api_key = app_store_connect_api_key(key_id: APPSTORE_KEY_ID,
                            issuer_id: APPSTORE_ISSUER_ID,
                            key_content: APPSTORE_KEY_CONTENT,
                            in_house: false,
                            is_key_content_base64: true)

    match(type: 'appstore',
          app_identifier: ENV['APP_IDENTIFIER'],
          api_key: api_key,
          force_for_new_devices: options[:update],
          include_all_certificates: options[:update],
          force_for_new_certificates: options[:update],
          readonly: options[:update] ? false : true,
          force: options[:update],
          platform: 'ios',
          verbose: true,
          generate_apple_certs: false,
          git_branch: "distribution"
          )

end
